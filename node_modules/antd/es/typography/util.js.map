{"version":3,"sources":["typography/util.jsx"],"names":["render","unmountComponentAtNode","React","toArray","ELEMENT_NODE","TEXT_NODE","COMMENT_NODE","ellipsisContainer","wrapperStyle","padding","margin","display","lineHeight","pxToNumber","value","match","Number","styleToString","style","styleNames","Array","prototype","slice","apply","map","name","getPropertyValue","join","mergeChildren","children","childList","forEach","child","prevChild","length","push","originEle","option","content","fixedContent","ellipsisStr","document","createElement","setAttribute","body","appendChild","rows","suffix","originStyle","window","getComputedStyle","originCSS","maxHeight","Math","round","paddingTop","paddingBottom","position","left","height","minHeight","top","zIndex","textOverflow","whiteSpace","webkitLineClamp","contentList","inRange","offsetHeight","text","innerHTML","ellipsis","childNodes","cloneNode","filter","nodeType","fixedNodes","ellipsisChildren","ellipsisContentHolder","ellipsisTextNode","createTextNode","childNode","appendChildNode","node","insertBefore","measureText","textNode","fullText","startLoc","endLoc","lastSuccessLoc","midLoc","floor","currentText","textContent","step","currentStepText","finished","reactNode","measureNode","index","type","removeChild","some"],"mappings":"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","sourcesContent":["import { render, unmountComponentAtNode } from 'react-dom';\nimport * as React from 'react';\nimport toArray from 'rc-util/lib/Children/toArray';\n// We only handle element & text node.\nconst ELEMENT_NODE = 1;\nconst TEXT_NODE = 3;\nconst COMMENT_NODE = 8;\nlet ellipsisContainer;\nconst wrapperStyle = {\n    padding: 0,\n    margin: 0,\n    display: 'inline',\n    lineHeight: 'inherit',\n};\nfunction pxToNumber(value) {\n    if (!value)\n        return 0;\n    const match = value.match(/^\\d*(\\.\\d*)?/);\n    return match ? Number(match[0]) : 0;\n}\nfunction styleToString(style) {\n    // There are some different behavior between Firefox & Chrome.\n    // We have to handle this ourself.\n    const styleNames = Array.prototype.slice.apply(style);\n    return styleNames.map(name => `${name}: ${style.getPropertyValue(name)};`).join('');\n}\nfunction mergeChildren(children) {\n    const childList = [];\n    children.forEach((child) => {\n        const prevChild = childList[childList.length - 1];\n        if (typeof child === 'string' && typeof prevChild === 'string') {\n            childList[childList.length - 1] += child;\n        }\n        else {\n            childList.push(child);\n        }\n    });\n    return childList;\n}\nexport default (originEle, option, content, fixedContent, ellipsisStr) => {\n    if (!ellipsisContainer) {\n        ellipsisContainer = document.createElement('div');\n        ellipsisContainer.setAttribute('aria-hidden', 'true');\n        document.body.appendChild(ellipsisContainer);\n    }\n    const { rows, suffix = '' } = option;\n    // Get origin style\n    const originStyle = window.getComputedStyle(originEle);\n    const originCSS = styleToString(originStyle);\n    const lineHeight = pxToNumber(originStyle.lineHeight);\n    const maxHeight = Math.round(lineHeight * (rows + 1) +\n        pxToNumber(originStyle.paddingTop) +\n        pxToNumber(originStyle.paddingBottom));\n    // Set shadow\n    ellipsisContainer.setAttribute('style', originCSS);\n    ellipsisContainer.style.position = 'fixed';\n    ellipsisContainer.style.left = '0';\n    ellipsisContainer.style.height = 'auto';\n    ellipsisContainer.style.minHeight = 'auto';\n    ellipsisContainer.style.maxHeight = 'auto';\n    ellipsisContainer.style.top = '-999999px';\n    ellipsisContainer.style.zIndex = '-1000';\n    // clean up css overflow\n    ellipsisContainer.style.textOverflow = 'clip';\n    ellipsisContainer.style.whiteSpace = 'normal';\n    ellipsisContainer.style.webkitLineClamp = 'none';\n    // Render in the fake container\n    const contentList = mergeChildren(toArray(content));\n    render(<div style={wrapperStyle}>\n      <span style={wrapperStyle}>\n        {contentList}\n        {suffix}\n      </span>\n      <span style={wrapperStyle}>{fixedContent}</span>\n    </div>, ellipsisContainer); // wrap in an div for old version react\n    // Check if ellipsis in measure div is height enough for content\n    function inRange() {\n        return ellipsisContainer.offsetHeight < maxHeight;\n    }\n    // Skip ellipsis if already match\n    if (inRange()) {\n        unmountComponentAtNode(ellipsisContainer);\n        return { content, text: ellipsisContainer.innerHTML, ellipsis: false };\n    }\n    // We should clone the childNode since they're controlled by React and we can't reuse it without warning\n    const childNodes = Array.prototype.slice\n        .apply(ellipsisContainer.childNodes[0].childNodes[0].cloneNode(true).childNodes)\n        .filter(({ nodeType }) => nodeType !== COMMENT_NODE);\n    const fixedNodes = Array.prototype.slice.apply(ellipsisContainer.childNodes[0].childNodes[1].cloneNode(true).childNodes);\n    unmountComponentAtNode(ellipsisContainer);\n    // ========================= Find match ellipsis content =========================\n    const ellipsisChildren = [];\n    ellipsisContainer.innerHTML = '';\n    // Create origin content holder\n    const ellipsisContentHolder = document.createElement('span');\n    ellipsisContainer.appendChild(ellipsisContentHolder);\n    const ellipsisTextNode = document.createTextNode(ellipsisStr + suffix);\n    ellipsisContentHolder.appendChild(ellipsisTextNode);\n    fixedNodes.forEach(childNode => {\n        ellipsisContainer.appendChild(childNode);\n    });\n    // Append before fixed nodes\n    function appendChildNode(node) {\n        ellipsisContentHolder.insertBefore(node, ellipsisTextNode);\n    }\n    // Get maximum text\n    function measureText(textNode, fullText, startLoc = 0, endLoc = fullText.length, lastSuccessLoc = 0) {\n        const midLoc = Math.floor((startLoc + endLoc) / 2);\n        const currentText = fullText.slice(0, midLoc);\n        textNode.textContent = currentText;\n        if (startLoc >= endLoc - 1) {\n            // Loop when step is small\n            for (let step = endLoc; step >= startLoc; step -= 1) {\n                const currentStepText = fullText.slice(0, step);\n                textNode.textContent = currentStepText;\n                if (inRange() || !currentStepText) {\n                    return step === fullText.length\n                        ? {\n                            finished: false,\n                            reactNode: fullText,\n                        }\n                        : {\n                            finished: true,\n                            reactNode: currentStepText,\n                        };\n                }\n            }\n        }\n        if (inRange()) {\n            return measureText(textNode, fullText, midLoc, endLoc, midLoc);\n        }\n        return measureText(textNode, fullText, startLoc, midLoc, lastSuccessLoc);\n    }\n    function measureNode(childNode, index) {\n        const type = childNode.nodeType;\n        if (type === ELEMENT_NODE) {\n            // We don't split element, it will keep if whole element can be displayed.\n            appendChildNode(childNode);\n            if (inRange()) {\n                return {\n                    finished: false,\n                    reactNode: contentList[index],\n                };\n            }\n            // Clean up if can not pull in\n            ellipsisContentHolder.removeChild(childNode);\n            return {\n                finished: true,\n                reactNode: null,\n            };\n        }\n        if (type === TEXT_NODE) {\n            const fullText = childNode.textContent || '';\n            const textNode = document.createTextNode(fullText);\n            appendChildNode(textNode);\n            return measureText(textNode, fullText);\n        }\n        // Not handle other type of content\n        // PS: This code should not be attached after react 16\n        return {\n            finished: false,\n            reactNode: null,\n        };\n    }\n    childNodes.some((childNode, index) => {\n        const { finished, reactNode } = measureNode(childNode, index);\n        if (reactNode) {\n            ellipsisChildren.push(reactNode);\n        }\n        return finished;\n    });\n    return {\n        content: ellipsisChildren,\n        text: ellipsisContainer.innerHTML,\n        ellipsis: true,\n    };\n};\n"],"file":"util.js"}