{"version":3,"sources":["table/hooks/useFilter/FilterDropdown.jsx"],"names":["React","classNames","FilterFilled","Menu","Checkbox","Radio","Dropdown","FilterDropdownMenuWrapper","useSyncState","SubMenu","MenuItem","Item","hasSubMenu","filters","some","children","renderFilterItems","prefixCls","filteredKeys","multiple","map","filter","index","value","text","Component","undefined","includes","String","FilterDropdown","props","column","dropdownPrefixCls","columnKey","filterMultiple","filterState","triggerFilter","locale","getPopupContainer","filterDropdownVisible","onFilterDropdownVisibleChange","useState","visible","setVisible","filtered","forceFiltered","triggerVisible","newVisible","mergedVisible","propFilteredKeys","getFilteredKeysSync","setFilteredKeysSync","onSelectKeys","selectedKeys","useEffect","openKeys","setOpenKeys","openRef","useRef","onOpenChange","keys","current","window","setTimeout","onMenuClick","clearTimeout","internalTriggerFilter","mergedKeys","length","key","onConfirm","onReset","onVisibleChange","filterDropdown","dropdownMenuClass","dropdownContent","setSelectedKeys","confirm","clearFilters","filterConfirm","filterReset","menu","filterIcon","e","stopPropagation","active"],"mappings":";;;;;;;;;;AAAA,OAAO,KAAKA,KAAZ,MAAuB,OAAvB;AACA,OAAOC,UAAP,MAAuB,YAAvB;AACA,OAAOC,YAAP,MAAyB,gCAAzB;AACA,OAAOC,IAAP,MAAiB,eAAjB;AACA,OAAOC,QAAP,MAAqB,mBAArB;AACA,OAAOC,KAAP,MAAkB,gBAAlB;AACA,OAAOC,QAAP,MAAqB,mBAArB;AACA,OAAOC,yBAAP,MAAsC,iBAAtC;AACA,OAAOC,YAAP,MAAyB,iBAAzB;IACQC,O,GAA4BN,I,CAA5BM,O;IAAeC,Q,GAAaP,I,CAAnBQ,I;;AACjB,SAASC,UAAT,CAAoBC,OAApB,EAA6B;AACzB,SAAOA,OAAO,CAACC,IAAR,CAAa;AAAA,QAAGC,QAAH,QAAGA,QAAH;AAAA,WAAkBA,QAAlB;AAAA,GAAb,CAAP;AACH;;AACD,SAASC,iBAAT,CAA2BH,OAA3B,EAAoCI,SAApC,EAA+CC,YAA/C,EAA6DC,QAA7D,EAAuE;AACnE,SAAON,OAAO,CAACO,GAAR,CAAY,UAACC,MAAD,EAASC,KAAT,EAAmB;AAClC,QAAID,MAAM,CAACN,QAAX,EAAqB;AACjB,aAAQ,oBAAC,OAAD;AAAS,QAAA,GAAG,EAAEM,MAAM,CAACE,KAAP,IAAgBD,KAA9B;AAAqC,QAAA,KAAK,EAAED,MAAM,CAACG,IAAnD;AAAyD,QAAA,cAAc,YAAKP,SAAL;AAAvE,SACTD,iBAAiB,CAACK,MAAM,CAACN,QAAR,EAAkBE,SAAlB,EAA6BC,YAA7B,EAA2CC,QAA3C,CADR,CAAR;AAGH;;AACD,QAAMM,SAAS,GAAGN,QAAQ,GAAGf,QAAH,GAAcC,KAAxC;AACA,WAAQ,oBAAC,QAAD;AAAU,MAAA,GAAG,EAAEgB,MAAM,CAACE,KAAP,KAAiBG,SAAjB,GAA6BL,MAAM,CAACE,KAApC,GAA4CD;AAA3D,OACR,oBAAC,SAAD;AAAW,MAAA,OAAO,EAAEJ,YAAY,CAACS,QAAb,CAAsBC,MAAM,CAACP,MAAM,CAACE,KAAR,CAA5B;AAApB,MADQ,EAER,kCAAOF,MAAM,CAACG,IAAd,CAFQ,CAAR;AAIH,GAXM,CAAP;AAYH;;AACD,SAASK,cAAT,CAAwBC,KAAxB,EAA+B;AAAA,MACnBb,SADmB,GACmHa,KADnH,CACnBb,SADmB;AAAA,MACRc,MADQ,GACmHD,KADnH,CACRC,MADQ;AAAA,MACAC,iBADA,GACmHF,KADnH,CACAE,iBADA;AAAA,MACmBC,SADnB,GACmHH,KADnH,CACmBG,SADnB;AAAA,MAC8BC,cAD9B,GACmHJ,KADnH,CAC8BI,cAD9B;AAAA,MAC8CC,WAD9C,GACmHL,KADnH,CAC8CK,WAD9C;AAAA,MAC2DC,aAD3D,GACmHN,KADnH,CAC2DM,aAD3D;AAAA,MAC0EC,MAD1E,GACmHP,KADnH,CAC0EO,MAD1E;AAAA,MACkFtB,QADlF,GACmHe,KADnH,CACkFf,QADlF;AAAA,MAC4FuB,iBAD5F,GACmHR,KADnH,CAC4FQ,iBAD5F;AAAA,MAEnBC,qBAFmB,GAEsCR,MAFtC,CAEnBQ,qBAFmB;AAAA,MAEIC,6BAFJ,GAEsCT,MAFtC,CAEIS,6BAFJ;;AAAA,wBAGGxC,KAAK,CAACyC,QAAN,CAAe,KAAf,CAHH;AAAA;AAAA,MAGpBC,OAHoB;AAAA,MAGXC,UAHW;;AAI3B,MAAMC,QAAQ,GAAG,CAAC,EAAET,WAAW,KAC1BA,WAAW,CAACjB,YAAZ,IAA4BiB,WAAW,CAACU,aADd,CAAb,CAAlB;;AAEA,MAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAACC,UAAD,EAAgB;AACnCJ,IAAAA,UAAU,CAACI,UAAD,CAAV;;AACA,QAAIP,6BAAJ,EAAmC;AAC/BA,MAAAA,6BAA6B,CAACO,UAAD,CAA7B;AACH;AACJ,GALD;;AAMA,MAAMC,aAAa,GAAG,OAAOT,qBAAP,KAAiC,SAAjC,GAA6CA,qBAA7C,GAAqEG,OAA3F,CAZ2B,CAa3B;;AACA,MAAMO,gBAAgB,GAAGd,WAAW,IAAIA,WAAW,CAACjB,YAApD;;AAd2B,sBAewBV,YAAY,CAACyC,gBAAgB,IAAI,EAArB,CAfpC;AAAA;AAAA,MAepBC,mBAfoB;AAAA,MAeCC,mBAfD;;AAgB3B,MAAMC,YAAY,GAAG,SAAfA,YAAe,QAAsB;AAAA,QAAnBC,YAAmB,SAAnBA,YAAmB;AACvCF,IAAAA,mBAAmB,CAACE,YAAD,CAAnB;AACH,GAFD;;AAGArD,EAAAA,KAAK,CAACsD,SAAN,CAAgB,YAAM;AAClBF,IAAAA,YAAY,CAAC;AAAEC,MAAAA,YAAY,EAAEJ,gBAAgB,IAAI;AAApC,KAAD,CAAZ;AACH,GAFD,EAEG,CAACA,gBAAD,CAFH,EAnB2B,CAsB3B;;AAtB2B,yBAuBKjD,KAAK,CAACyC,QAAN,CAAe,EAAf,CAvBL;AAAA;AAAA,MAuBpBc,QAvBoB;AAAA,MAuBVC,WAvBU;;AAwB3B,MAAMC,OAAO,GAAGzD,KAAK,CAAC0D,MAAN,EAAhB;;AACA,MAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,IAAD,EAAU;AAC3BH,IAAAA,OAAO,CAACI,OAAR,GAAkBC,MAAM,CAACC,UAAP,CAAkB,YAAM;AACtCP,MAAAA,WAAW,CAACI,IAAD,CAAX;AACH,KAFiB,CAAlB;AAGH,GAJD;;AAKA,MAAMI,WAAW,GAAG,SAAdA,WAAc,GAAM;AACtBF,IAAAA,MAAM,CAACG,YAAP,CAAoBR,OAAO,CAACI,OAA5B;AACH,GAFD;;AAGA7D,EAAAA,KAAK,CAACsD,SAAN,CAAgB,YAAM;AAClB,WAAO,YAAM;AACTQ,MAAAA,MAAM,CAACG,YAAP,CAAoBR,OAAO,CAACI,OAA5B;AACH,KAFD;AAGH,GAJD,EAIG,EAJH,EAjC2B,CAsC3B;;AACA,MAAMK,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACN,IAAD,EAAU;AACpCd,IAAAA,cAAc,CAAC,KAAD,CAAd;AACA,QAAMqB,UAAU,GAAGP,IAAI,IAAIA,IAAI,CAACQ,MAAb,GAAsBR,IAAtB,GAA6B,IAAhD;;AACA,QAAIO,UAAU,KAAK,IAAf,KAAwB,CAAChC,WAAD,IAAgB,CAACA,WAAW,CAACjB,YAArD,CAAJ,EAAwE;AACpE,aAAO,IAAP;AACH;;AACDkB,IAAAA,aAAa,CAAC;AACVL,MAAAA,MAAM,EAANA,MADU;AAEVsC,MAAAA,GAAG,EAAEpC,SAFK;AAGVf,MAAAA,YAAY,EAAEiD;AAHJ,KAAD,CAAb;AAKH,GAXD;;AAYA,MAAMG,SAAS,GAAG,SAAZA,SAAY,GAAM;AACpBJ,IAAAA,qBAAqB,CAAChB,mBAAmB,EAApB,CAArB;AACH,GAFD;;AAGA,MAAMqB,OAAO,GAAG,SAAVA,OAAU,GAAM;AAClBL,IAAAA,qBAAqB,CAAC,EAAD,CAArB;AACH,GAFD;;AAGA,MAAMM,eAAe,GAAG,SAAlBA,eAAkB,CAACzB,UAAD,EAAgB;AACpCD,IAAAA,cAAc,CAACC,UAAD,CAAd,CADoC,CAEpC;;AACA,QAAI,CAACA,UAAD,IAAe,CAAChB,MAAM,CAAC0C,cAA3B,EAA2C;AACvCH,MAAAA,SAAS;AACZ;AACJ,GAND,CAzD2B,CAgE3B;;;AACA,MAAMI,iBAAiB,GAAGzE,UAAU,+BAC5B+B,iBAD4B,4BACe,CAACpB,UAAU,CAACmB,MAAM,CAAClB,OAAP,IAAkB,EAAnB,CAD1B,EAApC;AAGA,MAAI8D,eAAJ;;AACA,MAAI,OAAO5C,MAAM,CAAC0C,cAAd,KAAiC,UAArC,EAAiD;AAC7CE,IAAAA,eAAe,GAAG5C,MAAM,CAAC0C,cAAP,CAAsB;AACpCxD,MAAAA,SAAS,YAAKe,iBAAL,YAD2B;AAEpC4C,MAAAA,eAAe,EAAE,yBAACvB,YAAD;AAAA,eAAkBD,YAAY,CAAC;AAAEC,UAAAA,YAAY,EAAZA;AAAF,SAAD,CAA9B;AAAA,OAFmB;AAGpCA,MAAAA,YAAY,EAAEH,mBAAmB,EAHG;AAIpC2B,MAAAA,OAAO,EAAEP,SAJ2B;AAKpCQ,MAAAA,YAAY,EAAEP,OALsB;AAMpC1D,MAAAA,OAAO,EAAEkB,MAAM,CAAClB,OANoB;AAOpC6B,MAAAA,OAAO,EAAEM;AAP2B,KAAtB,CAAlB;AASH,GAVD,MAWK,IAAIjB,MAAM,CAAC0C,cAAX,EAA2B;AAC5BE,IAAAA,eAAe,GAAG5C,MAAM,CAAC0C,cAAzB;AACH,GAFI,MAGA;AACDE,IAAAA,eAAe,GAAI,0CACnB,oBAAC,IAAD;AAAM,MAAA,QAAQ,EAAEzC,cAAhB;AAAgC,MAAA,SAAS,YAAKF,iBAAL,UAAzC;AAAwE,MAAA,SAAS,EAAE0C,iBAAnF;AAAsG,MAAA,OAAO,EAAEV,WAA/G;AAA4H,MAAA,QAAQ,EAAEZ,YAAtI;AAAoJ,MAAA,UAAU,EAAEA,YAAhK;AAA8K,MAAA,YAAY,EAAGF,mBAAmB,MAAM,EAAtN;AAA2N,MAAA,iBAAiB,EAAEZ,iBAA9O;AAAiQ,MAAA,QAAQ,EAAEiB,QAA3Q;AAAqR,MAAA,YAAY,EAAEI;AAAnS,OACG3C,iBAAiB,CAACe,MAAM,CAAClB,OAAR,EAAiBI,SAAjB,EAA4BiC,mBAAmB,EAA/C,EAAmDhB,cAAnD,CADpB,CADmB,EAInB;AAAK,MAAA,SAAS,YAAKjB,SAAL;AAAd,OACE;AAAG,MAAA,SAAS,YAAKA,SAAL,2BAAZ;AAAoD,MAAA,OAAO,EAAEqD;AAA7D,OACGjC,MAAM,CAAC0C,aADV,CADF,EAIE;AAAG,MAAA,SAAS,YAAK9D,SAAL,yBAAZ;AAAkD,MAAA,OAAO,EAAEsD;AAA3D,OACGlC,MAAM,CAAC2C,WADV,CAJF,CAJmB,CAAnB;AAaH;;AACD,MAAMC,IAAI,GAAI,oBAAC,yBAAD;AAA2B,IAAA,SAAS,YAAKhE,SAAL;AAApC,KACX0D,eADW,CAAd;AAGA,MAAIO,UAAJ;;AACA,MAAI,OAAOnD,MAAM,CAACmD,UAAd,KAA6B,UAAjC,EAA6C;AACzCA,IAAAA,UAAU,GAAGnD,MAAM,CAACmD,UAAP,CAAkBtC,QAAlB,CAAb;AACH,GAFD,MAGK,IAAIb,MAAM,CAACmD,UAAX,EAAuB;AACxBA,IAAAA,UAAU,GAAGnD,MAAM,CAACmD,UAApB;AACH,GAFI,MAGA;AACDA,IAAAA,UAAU,GAAG,oBAAC,YAAD,OAAb;AACH;;AACD,SAAQ;AAAK,IAAA,SAAS,EAAEjF,UAAU,WAAIgB,SAAJ;AAA1B,KACN;AAAM,IAAA,SAAS,YAAKA,SAAL;AAAf,KAA+CF,QAA/C,CADM,EAGN;AAAM,IAAA,SAAS,EAAEd,UAAU,WAAIgB,SAAJ,uDACrBA,SADqB,8BACgB+B,aADhB,EAA3B;AAEE,IAAA,OAAO,EAAE,iBAAAmC,CAAC,EAAI;AACdA,MAAAA,CAAC,CAACC,eAAF;AACH;AAJC,KAKE,oBAAC,QAAD;AAAU,IAAA,OAAO,EAAEH,IAAnB;AAAyB,IAAA,OAAO,EAAE,CAAC,OAAD,CAAlC;AAA6C,IAAA,OAAO,EAAEjC,aAAtD;AAAqE,IAAA,eAAe,EAAEwB,eAAtF;AAAuG,IAAA,iBAAiB,EAAElC,iBAA1H;AAA6I,IAAA,SAAS,EAAC;AAAvJ,KACE;AAAM,IAAA,IAAI,EAAC,QAAX;AAAoB,IAAA,QAAQ,EAAE,CAAC,CAA/B;AAAkC,IAAA,SAAS,EAAErC,UAAU,WAAIgB,SAAJ,eAAyB;AAClFoE,MAAAA,MAAM,EAAEzC;AAD0E,KAAzB;AAAvD,KAGGsC,UAHH,CADF,CALF,CAHM,CAAR;AAiBH;;AACD,eAAerD,cAAf","sourcesContent":["import * as React from 'react';\nimport classNames from 'classnames';\nimport FilterFilled from '@ant-design/icons/FilterFilled';\nimport Menu from '../../../menu';\nimport Checkbox from '../../../checkbox';\nimport Radio from '../../../radio';\nimport Dropdown from '../../../dropdown';\nimport FilterDropdownMenuWrapper from './FilterWrapper';\nimport useSyncState from '../useSyncState';\nconst { SubMenu, Item: MenuItem } = Menu;\nfunction hasSubMenu(filters) {\n    return filters.some(({ children }) => children);\n}\nfunction renderFilterItems(filters, prefixCls, filteredKeys, multiple) {\n    return filters.map((filter, index) => {\n        if (filter.children) {\n            return (<SubMenu key={filter.value || index} title={filter.text} popupClassName={`${prefixCls}-dropdown-submenu`}>\n          {renderFilterItems(filter.children, prefixCls, filteredKeys, multiple)}\n        </SubMenu>);\n        }\n        const Component = multiple ? Checkbox : Radio;\n        return (<MenuItem key={filter.value !== undefined ? filter.value : index}>\n        <Component checked={filteredKeys.includes(String(filter.value))}/>\n        <span>{filter.text}</span>\n      </MenuItem>);\n    });\n}\nfunction FilterDropdown(props) {\n    const { prefixCls, column, dropdownPrefixCls, columnKey, filterMultiple, filterState, triggerFilter, locale, children, getPopupContainer, } = props;\n    const { filterDropdownVisible, onFilterDropdownVisibleChange } = column;\n    const [visible, setVisible] = React.useState(false);\n    const filtered = !!(filterState &&\n        (filterState.filteredKeys || filterState.forceFiltered));\n    const triggerVisible = (newVisible) => {\n        setVisible(newVisible);\n        if (onFilterDropdownVisibleChange) {\n            onFilterDropdownVisibleChange(newVisible);\n        }\n    };\n    const mergedVisible = typeof filterDropdownVisible === 'boolean' ? filterDropdownVisible : visible;\n    // ===================== Select Keys =====================\n    const propFilteredKeys = filterState && filterState.filteredKeys;\n    const [getFilteredKeysSync, setFilteredKeysSync] = useSyncState(propFilteredKeys || []);\n    const onSelectKeys = ({ selectedKeys }) => {\n        setFilteredKeysSync(selectedKeys);\n    };\n    React.useEffect(() => {\n        onSelectKeys({ selectedKeys: propFilteredKeys || [] });\n    }, [propFilteredKeys]);\n    // ====================== Open Keys ======================\n    const [openKeys, setOpenKeys] = React.useState([]);\n    const openRef = React.useRef();\n    const onOpenChange = (keys) => {\n        openRef.current = window.setTimeout(() => {\n            setOpenKeys(keys);\n        });\n    };\n    const onMenuClick = () => {\n        window.clearTimeout(openRef.current);\n    };\n    React.useEffect(() => {\n        return () => {\n            window.clearTimeout(openRef.current);\n        };\n    }, []);\n    // ======================= Submit ========================\n    const internalTriggerFilter = (keys) => {\n        triggerVisible(false);\n        const mergedKeys = keys && keys.length ? keys : null;\n        if (mergedKeys === null && (!filterState || !filterState.filteredKeys)) {\n            return null;\n        }\n        triggerFilter({\n            column,\n            key: columnKey,\n            filteredKeys: mergedKeys,\n        });\n    };\n    const onConfirm = () => {\n        internalTriggerFilter(getFilteredKeysSync());\n    };\n    const onReset = () => {\n        internalTriggerFilter([]);\n    };\n    const onVisibleChange = (newVisible) => {\n        triggerVisible(newVisible);\n        // Default will filter when closed\n        if (!newVisible && !column.filterDropdown) {\n            onConfirm();\n        }\n    };\n    // ======================== Style ========================\n    const dropdownMenuClass = classNames({\n        [`${dropdownPrefixCls}-menu-without-submenu`]: !hasSubMenu(column.filters || []),\n    });\n    let dropdownContent;\n    if (typeof column.filterDropdown === 'function') {\n        dropdownContent = column.filterDropdown({\n            prefixCls: `${dropdownPrefixCls}-custom`,\n            setSelectedKeys: (selectedKeys) => onSelectKeys({ selectedKeys }),\n            selectedKeys: getFilteredKeysSync(),\n            confirm: onConfirm,\n            clearFilters: onReset,\n            filters: column.filters,\n            visible: mergedVisible,\n        });\n    }\n    else if (column.filterDropdown) {\n        dropdownContent = column.filterDropdown;\n    }\n    else {\n        dropdownContent = (<>\n        <Menu multiple={filterMultiple} prefixCls={`${dropdownPrefixCls}-menu`} className={dropdownMenuClass} onClick={onMenuClick} onSelect={onSelectKeys} onDeselect={onSelectKeys} selectedKeys={(getFilteredKeysSync() || [])} getPopupContainer={getPopupContainer} openKeys={openKeys} onOpenChange={onOpenChange}>\n          {renderFilterItems(column.filters, prefixCls, getFilteredKeysSync(), filterMultiple)}\n        </Menu>\n        <div className={`${prefixCls}-dropdown-btns`}>\n          <a className={`${prefixCls}-dropdown-link confirm`} onClick={onConfirm}>\n            {locale.filterConfirm}\n          </a>\n          <a className={`${prefixCls}-dropdown-link clear`} onClick={onReset}>\n            {locale.filterReset}\n          </a>\n        </div>\n      </>);\n    }\n    const menu = (<FilterDropdownMenuWrapper className={`${prefixCls}-dropdown`}>\n      {dropdownContent}\n    </FilterDropdownMenuWrapper>);\n    let filterIcon;\n    if (typeof column.filterIcon === 'function') {\n        filterIcon = column.filterIcon(filtered);\n    }\n    else if (column.filterIcon) {\n        filterIcon = column.filterIcon;\n    }\n    else {\n        filterIcon = <FilterFilled />;\n    }\n    return (<div className={classNames(`${prefixCls}-column`)}>\n      <span className={`${prefixCls}-column-title`}>{children}</span>\n\n      <span className={classNames(`${prefixCls}-trigger-container`, {\n        [`${prefixCls}-trigger-container-open`]: mergedVisible,\n    })} onClick={e => {\n        e.stopPropagation();\n    }}>\n        <Dropdown overlay={menu} trigger={['click']} visible={mergedVisible} onVisibleChange={onVisibleChange} getPopupContainer={getPopupContainer} placement=\"bottomRight\">\n          <span role=\"button\" tabIndex={-1} className={classNames(`${prefixCls}-trigger`, {\n        active: filtered,\n    })}>\n            {filterIcon}\n          </span>\n        </Dropdown>\n      </span>\n    </div>);\n}\nexport default FilterDropdown;\n"],"file":"FilterDropdown.js"}