{"version":3,"sources":["form/util.js"],"names":["React","useForm","useRcForm","scrollIntoView","useCacheErrors","errors","changeTrigger","directly","cacheRef","useRef","visible","length","useState","forceUpdate","update","prevVisible","current","newVisible","prevErrors","some","prevErr","index","useEffect","timeout","setTimeout","clearTimeout","toArray","candidate","undefined","Array","isArray","getFieldId","namePath","formName","mergedId","join","form","rcForm","wrapForm","useMemo","__INTERNAL__","scrollToField","name","options","fieldId","node","document","getElementById","scrollMode","block"],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport { useForm as useRcForm } from 'rc-field-form';\nimport scrollIntoView from 'scroll-into-view-if-needed';\n/**\n * Always debounce error to avoid [error -> null -> error] blink\n */\nexport function useCacheErrors(errors, changeTrigger, directly) {\n    const cacheRef = React.useRef({\n        errors,\n        visible: !!errors.length,\n    });\n    const [, forceUpdate] = React.useState({});\n    const update = () => {\n        const prevVisible = cacheRef.current.visible;\n        const newVisible = !!errors.length;\n        const prevErrors = cacheRef.current.errors;\n        cacheRef.current.errors = errors;\n        cacheRef.current.visible = newVisible;\n        if (prevVisible !== newVisible) {\n            changeTrigger(newVisible);\n        }\n        else if (prevErrors.length !== errors.length ||\n            prevErrors.some((prevErr, index) => prevErr !== errors[index])) {\n            forceUpdate({});\n        }\n    };\n    React.useEffect(() => {\n        if (!directly) {\n            const timeout = setTimeout(update, 10);\n            return () => clearTimeout(timeout);\n        }\n    }, [errors]);\n    if (directly) {\n        update();\n    }\n    return [cacheRef.current.visible, cacheRef.current.errors];\n}\nexport function toArray(candidate) {\n    if (candidate === undefined || candidate === false)\n        return [];\n    return Array.isArray(candidate) ? candidate : [candidate];\n}\nexport function getFieldId(namePath, formName) {\n    if (!namePath.length)\n        return undefined;\n    const mergedId = namePath.join('_');\n    return formName ? `${formName}_${mergedId}` : mergedId;\n}\nexport function useForm(form) {\n    const [rcForm] = useRcForm();\n    const wrapForm = React.useMemo(() => form || Object.assign(Object.assign({}, rcForm), { __INTERNAL__: {}, scrollToField: (name, options = {}) => {\n            const namePath = toArray(name);\n            const fieldId = getFieldId(namePath, wrapForm.__INTERNAL__.name);\n            const node = fieldId ? document.getElementById(fieldId) : null;\n            if (node) {\n                scrollIntoView(node, Object.assign({ scrollMode: 'if-needed', block: 'nearest' }, options));\n            }\n        } }), [form, rcForm]);\n    return [wrapForm];\n}\n"],"file":"util.js"}