{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nimport toChildrenArray from \"rc-util/es/Children/toArray\";\nimport warning from \"rc-util/es/warning\";\nimport * as React from 'react';\nimport FieldContext, { HOOK_MARK } from './FieldContext';\nimport { toArray } from './utils/typeUtil';\nimport { validateRules } from './utils/validateUtil';\nimport { containsNamePath, defaultGetValueFromEvent, getNamePath, getValue } from './utils/valueUtil';\n\nfunction requireUpdate(shouldUpdate, prev, next, prevValue, nextValue, info) {\n  if (typeof shouldUpdate === 'function') {\n    return shouldUpdate(prev, next, 'source' in info ? {\n      source: info.source\n    } : {});\n  }\n\n  return prevValue !== nextValue;\n} // We use Class instead of Hooks here since it will cost much code by using Hooks.\n\n\nvar Field =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(Field, _React$Component);\n\n  function Field() {\n    var _this;\n\n    _classCallCheck(this, Field);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Field).apply(this, arguments));\n    _this.state = {\n      resetCount: 0\n    };\n    _this.cancelRegisterFunc = null;\n    _this.destroy = false;\n    /**\n     * Follow state should not management in State since it will async update by React.\n     * This makes first render of form can not get correct state value.\n     */\n\n    _this.touched = false;\n    _this.validatePromise = null;\n    _this.errors = [];\n\n    _this.cancelRegister = function () {\n      if (_this.cancelRegisterFunc) {\n        _this.cancelRegisterFunc();\n      }\n\n      _this.cancelRegisterFunc = null;\n    }; // ================================== Utils ==================================\n\n\n    _this.getNamePath = function () {\n      var name = _this.props.name;\n      var _this$context$prefixN = _this.context.prefixName,\n          prefixName = _this$context$prefixN === void 0 ? [] : _this$context$prefixN;\n      var namePath = getNamePath(name);\n      return 'name' in _this.props ? [].concat(_toConsumableArray(prefixName), _toConsumableArray(namePath)) : [];\n    };\n\n    _this.getRules = function () {\n      var _this$props$rules = _this.props.rules,\n          rules = _this$props$rules === void 0 ? [] : _this$props$rules;\n      return rules.map(function (rule) {\n        if (typeof rule === 'function') {\n          return rule(_this.context);\n        }\n\n        return rule;\n      });\n    };\n\n    _this.refresh = function () {\n      if (_this.destroy) return;\n      /**\n       * Clean up current node.\n       */\n\n      _this.setState(function (_ref) {\n        var resetCount = _ref.resetCount;\n        return {\n          resetCount: resetCount + 1\n        };\n      });\n    }; // ========================= Field Entity Interfaces =========================\n    // Trigger by store update. Check if need update the component\n\n\n    _this.onStoreChange = function (prevStore, namePathList, info) {\n      var _this$props = _this.props,\n          shouldUpdate = _this$props.shouldUpdate,\n          _this$props$dependenc = _this$props.dependencies,\n          dependencies = _this$props$dependenc === void 0 ? [] : _this$props$dependenc,\n          onReset = _this$props.onReset;\n      var getFieldsValue = _this.context.getFieldsValue;\n      var values = getFieldsValue(true);\n\n      var namePath = _this.getNamePath();\n\n      var prevValue = _this.getValue(prevStore);\n\n      var curValue = _this.getValue();\n\n      var namePathMatch = namePathList && containsNamePath(namePathList, namePath); // `setFieldsValue` is a quick access to update related status\n\n      if (info.type === 'valueUpdate' && info.source === 'external' && prevValue !== curValue) {\n        _this.touched = true;\n        _this.validatePromise = null;\n        _this.errors = [];\n      }\n\n      switch (info.type) {\n        case 'reset':\n          if (!namePathList || namePathMatch) {\n            // Clean up state\n            _this.touched = false;\n            _this.validatePromise = null;\n            _this.errors = [];\n\n            if (onReset) {\n              onReset();\n            }\n\n            _this.refresh();\n\n            return;\n          }\n\n          break;\n\n        case 'setField':\n          {\n            if (namePathMatch) {\n              var data = info.data;\n\n              if ('touched' in data) {\n                _this.touched = data.touched;\n              }\n\n              if ('validating' in data) {\n                _this.validatePromise = data.validating ? Promise.resolve([]) : null;\n              }\n\n              if ('errors' in data) {\n                _this.errors = data.errors || [];\n              }\n\n              _this.reRender();\n\n              return;\n            } // Handle update by `setField` with `shouldUpdate`\n\n\n            if (shouldUpdate && !namePath.length && requireUpdate(shouldUpdate, prevStore, values, prevValue, curValue, info)) {\n              _this.reRender();\n\n              return;\n            }\n\n            break;\n          }\n\n        case 'dependenciesUpdate':\n          {\n            /**\n             * Trigger when marked `dependencies` updated. Related fields will all update\n             */\n            var dependencyList = dependencies.map(getNamePath);\n\n            if (namePathMatch || dependencyList.some(function (dependency) {\n              return containsNamePath(info.relatedFields, dependency);\n            })) {\n              _this.reRender();\n\n              return;\n            }\n\n            break;\n          }\n\n        default:\n          /**\n           * - If `namePath` exists in `namePathList`, means it's related value and should update.\n           * - If `dependencies` exists in `namePathList`, means upstream trigger update.\n           * - If `shouldUpdate` provided, use customize logic to update the field\n           *   - else to check if value changed\n           */\n          if (namePathMatch || dependencies.some(function (dependency) {\n            return containsNamePath(namePathList, getNamePath(dependency));\n          }) || requireUpdate(shouldUpdate, prevStore, values, prevValue, curValue, info)) {\n            _this.reRender();\n\n            return;\n          }\n\n          break;\n      }\n\n      if (shouldUpdate === true) {\n        _this.reRender();\n      }\n    };\n\n    _this.validateRules = function (options) {\n      var validateFirst = _this.props.validateFirst;\n\n      var _ref2 = options || {},\n          triggerName = _ref2.triggerName;\n\n      var namePath = _this.getNamePath();\n\n      var filteredRules = _this.getRules();\n\n      if (triggerName) {\n        filteredRules = filteredRules.filter(function (rule) {\n          var validateTrigger = rule.validateTrigger;\n\n          if (!validateTrigger) {\n            return true;\n          }\n\n          var triggerList = toArray(validateTrigger);\n          return triggerList.includes(triggerName);\n        });\n      }\n\n      var promise = validateRules(namePath, _this.getValue(), filteredRules, options, validateFirst);\n      _this.validatePromise = promise;\n      _this.errors = [];\n      promise.catch(function (e) {\n        return e;\n      }).then(function () {\n        var errors = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n        if (_this.validatePromise === promise) {\n          _this.validatePromise = null;\n          _this.errors = errors;\n\n          _this.reRender();\n        }\n      });\n      return promise;\n    };\n\n    _this.isFieldValidating = function () {\n      return !!_this.validatePromise;\n    };\n\n    _this.isFieldTouched = function () {\n      return _this.touched;\n    };\n\n    _this.getErrors = function () {\n      return _this.errors;\n    }; // ============================= Child Component =============================\n\n\n    _this.getMeta = function () {\n      // Make error & validating in cache to save perf\n      _this.prevValidating = _this.isFieldValidating();\n      var meta = {\n        touched: _this.isFieldTouched(),\n        validating: _this.prevValidating,\n        errors: _this.errors,\n        name: _this.getNamePath()\n      };\n      return meta;\n    }; // Only return validate child node. If invalidate, will do nothing about field.\n\n\n    _this.getOnlyChild = function (children) {\n      // Support render props\n      if (typeof children === 'function') {\n        var meta = _this.getMeta();\n\n        return _objectSpread({}, _this.getOnlyChild(children(_this.getControlled(), meta, _this.context)), {\n          isFunction: true\n        });\n      } // Filed element only\n\n\n      var childList = toChildrenArray(children);\n\n      if (childList.length !== 1 || !React.isValidElement(childList[0])) {\n        return {\n          child: childList,\n          isFunction: false\n        };\n      }\n\n      return {\n        child: childList[0],\n        isFunction: false\n      };\n    }; // ============================== Field Control ==============================\n\n\n    _this.getValue = function (store) {\n      var getFieldsValue = _this.context.getFieldsValue;\n\n      var namePath = _this.getNamePath();\n\n      return getValue(store || getFieldsValue(true), namePath);\n    };\n\n    _this.getControlled = function () {\n      var childProps = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var _this$props2 = _this.props,\n          trigger = _this$props2.trigger,\n          validateTrigger = _this$props2.validateTrigger,\n          getValueFromEvent = _this$props2.getValueFromEvent,\n          normalize = _this$props2.normalize,\n          valuePropName = _this$props2.valuePropName;\n\n      var namePath = _this.getNamePath();\n\n      var _this$context = _this.context,\n          getInternalHooks = _this$context.getInternalHooks,\n          getFieldsValue = _this$context.getFieldsValue;\n\n      var _getInternalHooks = getInternalHooks(HOOK_MARK),\n          dispatch = _getInternalHooks.dispatch;\n\n      var value = _this.getValue(); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n      var originTriggerFunc = childProps[trigger];\n\n      var control = _objectSpread({}, childProps, _defineProperty({}, valuePropName, value)); // Add trigger\n\n\n      control[trigger] = function () {\n        // Mark as touched\n        _this.touched = true;\n        var newValue;\n\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        if (getValueFromEvent) {\n          newValue = getValueFromEvent.apply(void 0, args);\n        } else {\n          newValue = defaultGetValueFromEvent.apply(void 0, [valuePropName].concat(args));\n        }\n\n        if (normalize) {\n          newValue = normalize(newValue, value, getFieldsValue(true));\n        }\n\n        dispatch({\n          type: 'updateValue',\n          namePath: namePath,\n          value: newValue\n        });\n\n        if (originTriggerFunc) {\n          originTriggerFunc.apply(void 0, args);\n        }\n      }; // Add validateTrigger\n\n\n      var validateTriggerList = toArray(validateTrigger || []);\n      validateTriggerList.forEach(function (triggerName) {\n        // Wrap additional function of component, so that we can get latest value from store\n        var originTrigger = control[triggerName];\n\n        control[triggerName] = function () {\n          if (originTrigger) {\n            originTrigger.apply(void 0, arguments);\n          } // Always use latest rules\n\n\n          var rules = _this.props.rules;\n\n          if (rules && rules.length) {\n            // We dispatch validate to root,\n            // since it will update related data with other field with same name\n            dispatch({\n              type: 'validateField',\n              namePath: namePath,\n              triggerName: triggerName\n            });\n          }\n        };\n      });\n      return control;\n    };\n\n    return _this;\n  } // ============================== Subscriptions ==============================\n\n\n  _createClass(Field, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var getInternalHooks = this.context.getInternalHooks;\n\n      var _getInternalHooks2 = getInternalHooks(HOOK_MARK),\n          registerField = _getInternalHooks2.registerField;\n\n      this.cancelRegisterFunc = registerField(this);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.cancelRegister();\n      this.destroy = true;\n    }\n  }, {\n    key: \"reRender\",\n    value: function reRender() {\n      if (this.destroy) return;\n      this.forceUpdate();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var resetCount = this.state.resetCount;\n      var children = this.props.children;\n\n      var _this$getOnlyChild = this.getOnlyChild(children),\n          child = _this$getOnlyChild.child,\n          isFunction = _this$getOnlyChild.isFunction; // Not need to `cloneElement` since user can handle this in render function self\n\n\n      var returnChildNode;\n\n      if (isFunction) {\n        returnChildNode = child;\n      } else if (React.isValidElement(child)) {\n        returnChildNode = React.cloneElement(child, this.getControlled(child.props));\n      } else {\n        warning(!child, '`children` of Field is not validate ReactElement.');\n        returnChildNode = child;\n      }\n\n      return React.createElement(React.Fragment, {\n        key: resetCount\n      }, returnChildNode);\n    }\n  }]);\n\n  return Field;\n}(React.Component);\n\nField.contextType = FieldContext;\nField.defaultProps = {\n  trigger: 'onChange',\n  validateTrigger: 'onChange',\n  valuePropName: 'value'\n};\nexport default Field;","map":{"version":3,"sources":["/Users/nancyou/Desktop/nasa/node_modules/rc-field-form/es/Field.js"],"names":["_defineProperty","_toConsumableArray","_classCallCheck","_createClass","_possibleConstructorReturn","_getPrototypeOf","_inherits","ownKeys","object","enumerableOnly","keys","Object","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","defineProperty","toChildrenArray","warning","React","FieldContext","HOOK_MARK","toArray","validateRules","containsNamePath","defaultGetValueFromEvent","getNamePath","getValue","requireUpdate","shouldUpdate","prev","next","prevValue","nextValue","info","Field","_React$Component","_this","state","resetCount","cancelRegisterFunc","destroy","touched","validatePromise","errors","cancelRegister","name","props","_this$context$prefixN","context","prefixName","namePath","concat","getRules","_this$props$rules","rules","map","rule","refresh","setState","_ref","onStoreChange","prevStore","namePathList","_this$props","_this$props$dependenc","dependencies","onReset","getFieldsValue","values","curValue","namePathMatch","type","data","validating","Promise","resolve","reRender","dependencyList","some","dependency","relatedFields","options","validateFirst","_ref2","triggerName","filteredRules","validateTrigger","triggerList","includes","promise","catch","e","then","undefined","isFieldValidating","isFieldTouched","getErrors","getMeta","prevValidating","meta","getOnlyChild","children","getControlled","isFunction","childList","isValidElement","child","store","childProps","_this$props2","trigger","getValueFromEvent","normalize","valuePropName","_this$context","getInternalHooks","_getInternalHooks","dispatch","value","originTriggerFunc","control","newValue","_len","args","Array","_key","validateTriggerList","originTrigger","componentDidMount","_getInternalHooks2","registerField","componentWillUnmount","forceUpdate","render","_this$getOnlyChild","returnChildNode","cloneElement","createElement","Fragment","Component","contextType","defaultProps"],"mappings":"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","sourcesContent":["import _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport toChildrenArray from \"rc-util/es/Children/toArray\";\nimport warning from \"rc-util/es/warning\";\nimport * as React from 'react';\nimport FieldContext, { HOOK_MARK } from './FieldContext';\nimport { toArray } from './utils/typeUtil';\nimport { validateRules } from './utils/validateUtil';\nimport { containsNamePath, defaultGetValueFromEvent, getNamePath, getValue } from './utils/valueUtil';\n\nfunction requireUpdate(shouldUpdate, prev, next, prevValue, nextValue, info) {\n  if (typeof shouldUpdate === 'function') {\n    return shouldUpdate(prev, next, 'source' in info ? {\n      source: info.source\n    } : {});\n  }\n\n  return prevValue !== nextValue;\n} // We use Class instead of Hooks here since it will cost much code by using Hooks.\n\n\nvar Field = /*#__PURE__*/function (_React$Component) {\n  _inherits(Field, _React$Component);\n\n  function Field() {\n    var _this;\n\n    _classCallCheck(this, Field);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Field).apply(this, arguments));\n    _this.state = {\n      resetCount: 0\n    };\n    _this.cancelRegisterFunc = null;\n    _this.destroy = false;\n    /**\n     * Follow state should not management in State since it will async update by React.\n     * This makes first render of form can not get correct state value.\n     */\n\n    _this.touched = false;\n    _this.validatePromise = null;\n    _this.errors = [];\n\n    _this.cancelRegister = function () {\n      if (_this.cancelRegisterFunc) {\n        _this.cancelRegisterFunc();\n      }\n\n      _this.cancelRegisterFunc = null;\n    }; // ================================== Utils ==================================\n\n\n    _this.getNamePath = function () {\n      var name = _this.props.name;\n      var _this$context$prefixN = _this.context.prefixName,\n          prefixName = _this$context$prefixN === void 0 ? [] : _this$context$prefixN;\n      var namePath = getNamePath(name);\n      return 'name' in _this.props ? [].concat(_toConsumableArray(prefixName), _toConsumableArray(namePath)) : [];\n    };\n\n    _this.getRules = function () {\n      var _this$props$rules = _this.props.rules,\n          rules = _this$props$rules === void 0 ? [] : _this$props$rules;\n      return rules.map(function (rule) {\n        if (typeof rule === 'function') {\n          return rule(_this.context);\n        }\n\n        return rule;\n      });\n    };\n\n    _this.refresh = function () {\n      if (_this.destroy) return;\n      /**\n       * Clean up current node.\n       */\n\n      _this.setState(function (_ref) {\n        var resetCount = _ref.resetCount;\n        return {\n          resetCount: resetCount + 1\n        };\n      });\n    }; // ========================= Field Entity Interfaces =========================\n    // Trigger by store update. Check if need update the component\n\n\n    _this.onStoreChange = function (prevStore, namePathList, info) {\n      var _this$props = _this.props,\n          shouldUpdate = _this$props.shouldUpdate,\n          _this$props$dependenc = _this$props.dependencies,\n          dependencies = _this$props$dependenc === void 0 ? [] : _this$props$dependenc,\n          onReset = _this$props.onReset;\n      var getFieldsValue = _this.context.getFieldsValue;\n      var values = getFieldsValue(true);\n\n      var namePath = _this.getNamePath();\n\n      var prevValue = _this.getValue(prevStore);\n\n      var curValue = _this.getValue();\n\n      var namePathMatch = namePathList && containsNamePath(namePathList, namePath); // `setFieldsValue` is a quick access to update related status\n\n      if (info.type === 'valueUpdate' && info.source === 'external' && prevValue !== curValue) {\n        _this.touched = true;\n        _this.validatePromise = null;\n        _this.errors = [];\n      }\n\n      switch (info.type) {\n        case 'reset':\n          if (!namePathList || namePathMatch) {\n            // Clean up state\n            _this.touched = false;\n            _this.validatePromise = null;\n            _this.errors = [];\n\n            if (onReset) {\n              onReset();\n            }\n\n            _this.refresh();\n\n            return;\n          }\n\n          break;\n\n        case 'setField':\n          {\n            if (namePathMatch) {\n              var data = info.data;\n\n              if ('touched' in data) {\n                _this.touched = data.touched;\n              }\n\n              if ('validating' in data) {\n                _this.validatePromise = data.validating ? Promise.resolve([]) : null;\n              }\n\n              if ('errors' in data) {\n                _this.errors = data.errors || [];\n              }\n\n              _this.reRender();\n\n              return;\n            } // Handle update by `setField` with `shouldUpdate`\n\n\n            if (shouldUpdate && !namePath.length && requireUpdate(shouldUpdate, prevStore, values, prevValue, curValue, info)) {\n              _this.reRender();\n\n              return;\n            }\n\n            break;\n          }\n\n        case 'dependenciesUpdate':\n          {\n            /**\n             * Trigger when marked `dependencies` updated. Related fields will all update\n             */\n            var dependencyList = dependencies.map(getNamePath);\n\n            if (namePathMatch || dependencyList.some(function (dependency) {\n              return containsNamePath(info.relatedFields, dependency);\n            })) {\n              _this.reRender();\n\n              return;\n            }\n\n            break;\n          }\n\n        default:\n          /**\n           * - If `namePath` exists in `namePathList`, means it's related value and should update.\n           * - If `dependencies` exists in `namePathList`, means upstream trigger update.\n           * - If `shouldUpdate` provided, use customize logic to update the field\n           *   - else to check if value changed\n           */\n          if (namePathMatch || dependencies.some(function (dependency) {\n            return containsNamePath(namePathList, getNamePath(dependency));\n          }) || requireUpdate(shouldUpdate, prevStore, values, prevValue, curValue, info)) {\n            _this.reRender();\n\n            return;\n          }\n\n          break;\n      }\n\n      if (shouldUpdate === true) {\n        _this.reRender();\n      }\n    };\n\n    _this.validateRules = function (options) {\n      var validateFirst = _this.props.validateFirst;\n\n      var _ref2 = options || {},\n          triggerName = _ref2.triggerName;\n\n      var namePath = _this.getNamePath();\n\n      var filteredRules = _this.getRules();\n\n      if (triggerName) {\n        filteredRules = filteredRules.filter(function (rule) {\n          var validateTrigger = rule.validateTrigger;\n\n          if (!validateTrigger) {\n            return true;\n          }\n\n          var triggerList = toArray(validateTrigger);\n          return triggerList.includes(triggerName);\n        });\n      }\n\n      var promise = validateRules(namePath, _this.getValue(), filteredRules, options, validateFirst);\n      _this.validatePromise = promise;\n      _this.errors = [];\n      promise.catch(function (e) {\n        return e;\n      }).then(function () {\n        var errors = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n\n        if (_this.validatePromise === promise) {\n          _this.validatePromise = null;\n          _this.errors = errors;\n\n          _this.reRender();\n        }\n      });\n      return promise;\n    };\n\n    _this.isFieldValidating = function () {\n      return !!_this.validatePromise;\n    };\n\n    _this.isFieldTouched = function () {\n      return _this.touched;\n    };\n\n    _this.getErrors = function () {\n      return _this.errors;\n    }; // ============================= Child Component =============================\n\n\n    _this.getMeta = function () {\n      // Make error & validating in cache to save perf\n      _this.prevValidating = _this.isFieldValidating();\n      var meta = {\n        touched: _this.isFieldTouched(),\n        validating: _this.prevValidating,\n        errors: _this.errors,\n        name: _this.getNamePath()\n      };\n      return meta;\n    }; // Only return validate child node. If invalidate, will do nothing about field.\n\n\n    _this.getOnlyChild = function (children) {\n      // Support render props\n      if (typeof children === 'function') {\n        var meta = _this.getMeta();\n\n        return _objectSpread({}, _this.getOnlyChild(children(_this.getControlled(), meta, _this.context)), {\n          isFunction: true\n        });\n      } // Filed element only\n\n\n      var childList = toChildrenArray(children);\n\n      if (childList.length !== 1 || !React.isValidElement(childList[0])) {\n        return {\n          child: childList,\n          isFunction: false\n        };\n      }\n\n      return {\n        child: childList[0],\n        isFunction: false\n      };\n    }; // ============================== Field Control ==============================\n\n\n    _this.getValue = function (store) {\n      var getFieldsValue = _this.context.getFieldsValue;\n\n      var namePath = _this.getNamePath();\n\n      return getValue(store || getFieldsValue(true), namePath);\n    };\n\n    _this.getControlled = function () {\n      var childProps = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      var _this$props2 = _this.props,\n          trigger = _this$props2.trigger,\n          validateTrigger = _this$props2.validateTrigger,\n          getValueFromEvent = _this$props2.getValueFromEvent,\n          normalize = _this$props2.normalize,\n          valuePropName = _this$props2.valuePropName;\n\n      var namePath = _this.getNamePath();\n\n      var _this$context = _this.context,\n          getInternalHooks = _this$context.getInternalHooks,\n          getFieldsValue = _this$context.getFieldsValue;\n\n      var _getInternalHooks = getInternalHooks(HOOK_MARK),\n          dispatch = _getInternalHooks.dispatch;\n\n      var value = _this.getValue(); // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n\n      var originTriggerFunc = childProps[trigger];\n\n      var control = _objectSpread({}, childProps, _defineProperty({}, valuePropName, value)); // Add trigger\n\n\n      control[trigger] = function () {\n        // Mark as touched\n        _this.touched = true;\n        var newValue;\n\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        if (getValueFromEvent) {\n          newValue = getValueFromEvent.apply(void 0, args);\n        } else {\n          newValue = defaultGetValueFromEvent.apply(void 0, [valuePropName].concat(args));\n        }\n\n        if (normalize) {\n          newValue = normalize(newValue, value, getFieldsValue(true));\n        }\n\n        dispatch({\n          type: 'updateValue',\n          namePath: namePath,\n          value: newValue\n        });\n\n        if (originTriggerFunc) {\n          originTriggerFunc.apply(void 0, args);\n        }\n      }; // Add validateTrigger\n\n\n      var validateTriggerList = toArray(validateTrigger || []);\n      validateTriggerList.forEach(function (triggerName) {\n        // Wrap additional function of component, so that we can get latest value from store\n        var originTrigger = control[triggerName];\n\n        control[triggerName] = function () {\n          if (originTrigger) {\n            originTrigger.apply(void 0, arguments);\n          } // Always use latest rules\n\n\n          var rules = _this.props.rules;\n\n          if (rules && rules.length) {\n            // We dispatch validate to root,\n            // since it will update related data with other field with same name\n            dispatch({\n              type: 'validateField',\n              namePath: namePath,\n              triggerName: triggerName\n            });\n          }\n        };\n      });\n      return control;\n    };\n\n    return _this;\n  } // ============================== Subscriptions ==============================\n\n\n  _createClass(Field, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var getInternalHooks = this.context.getInternalHooks;\n\n      var _getInternalHooks2 = getInternalHooks(HOOK_MARK),\n          registerField = _getInternalHooks2.registerField;\n\n      this.cancelRegisterFunc = registerField(this);\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this.cancelRegister();\n      this.destroy = true;\n    }\n  }, {\n    key: \"reRender\",\n    value: function reRender() {\n      if (this.destroy) return;\n      this.forceUpdate();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var resetCount = this.state.resetCount;\n      var children = this.props.children;\n\n      var _this$getOnlyChild = this.getOnlyChild(children),\n          child = _this$getOnlyChild.child,\n          isFunction = _this$getOnlyChild.isFunction; // Not need to `cloneElement` since user can handle this in render function self\n\n\n      var returnChildNode;\n\n      if (isFunction) {\n        returnChildNode = child;\n      } else if (React.isValidElement(child)) {\n        returnChildNode = React.cloneElement(child, this.getControlled(child.props));\n      } else {\n        warning(!child, '`children` of Field is not validate ReactElement.');\n        returnChildNode = child;\n      }\n\n      return React.createElement(React.Fragment, {\n        key: resetCount\n      }, returnChildNode);\n    }\n  }]);\n\n  return Field;\n}(React.Component);\n\nField.contextType = FieldContext;\nField.defaultProps = {\n  trigger: 'onChange',\n  validateTrigger: 'onChange',\n  valuePropName: 'value'\n};\nexport default Field;"]},"metadata":{},"sourceType":"module"}